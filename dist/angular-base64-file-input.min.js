angular.module("ByGiro.base64FileInput",[]).directive("base64Input",["$window","$parse",function(e){return{restrict:"A",require:"ngModel",link:function(a,i,t,n){function r(a){for(var i="",t=new Uint8Array(a),n=t.byteLength,r=0;n>r;r++)i+=String.fromCharCode(t[r]);return e.btoa(i)}function s(){switch(preview="",this.previewType){case"image":preview="data:image/"+this.filetype+";base64,"+this.base64;break;case"text":preview=decodeURIComponent(escape(e.atob(this.base64)))}return preview}var o={};a.readerOnload=function(e){var i=r(e.target.result);o.base64=i,a.$apply(function(){n.$setViewValue(angular.copy(o))})};var p=new FileReader;p.onload=a.readerOnload,i.on("change",function(){var e=i[0].files[0];switch(o.filetype=e.type,o.filename=e.name,o.extension="",e.name.lastIndexOf(".")>=0&&(o.extension=e.name.substr(e.name.lastIndexOf(".")+1)),o.filesize=e.size,o.getPreview=s,p.readAsArrayBuffer(e),o.previewType="",!0){case o.filetype.indexOf("image/")>=0:o.previewType="image";break;case o.filetype.indexOf("text/")>=0:o.previewType="text";break;default:o.previewType="extension"}})}}}]);